<?php

require_once __DIR__ . '/wp-ww_auth_log.test';

/**
* Run the WPWWAuthLogTestCase multiple times to trigger fail2ban without having to
* run the test several times and incur the long setup time for each.
*
* NOTE: a network interface must exist for 1.2.3.4 i.e.
*       'sudo ifconfig eth0:123 1.2.3.4'
**/
class WPWWAuthLogFail2BanTestCase extends WPWWAuthLogTestCase {

  /**
  * IP to use for curl requests.
  * @var string
  **/
  const IP_ADDR = '1.2.3.4';

  public function setUp() {
    putenv('IP='. self::IP_ADDR);
    parent::setUp();
  }

  /**
  * Trigger multiple failed login tests.
  **/
  public function testFailedLogin() {
    for ($i=0; $i <= 5; $i++) {
      parent::testFailedLogin();
      sleep(1);// avoid blocking from mod_evasive
    }
  }
}
